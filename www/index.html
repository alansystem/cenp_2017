<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <!--<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css" />-->
    <!--<link rel="stylesheet" href="css/bootstrap.css">-->
    <title>CENP em Revista</title>
    <style type="text/css">
        .invisivel{
            visibility:hidden;
            display:none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row text-center">
            <center>
                <!--<img src="img/cenp-logo.png" class="img-responsive">-->
                <div class="col-sm-12 col-xs-12" style="margin-top: 20px;margin-bottom: 20px">
                    <img src="http://clarearpropaganda.com.br/appcenp/revista/img/capa.jpg" class="img-responsive">
                </div>

            </center>
            <h4>carregando...</h4>
        </div>

        <div class="revistas invisivel"></div>

    </div><!-- Fim container -->
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript">
        try {
            app.initialize();
        } catch (e) {
        //
        }
    </script>
    <script src="js/jquery.min.js"></script>
    <!--<script src="js/jquery.mobile-1.4.5.min.js"></script>-->
    <script type="text/javascript">
        document.addEventListener("deviceready", onDeviceReady_i, false);

        function onDeviceReady_i() {
            
            //setTimeout(function () {
                //Caso esteja logado

                if (localStorage.getItem('logado') == 'true') {
                    //location.href = "home.html";                

                    //window.setTimeout(function () {
                        var networkState = navigator.connection.type;

                                                                    
                        if (networkState !== 'none') {
                            $.ajax({
                                method: "GET",
                                //async: false,
                                url: "http://clarearpropaganda.com.br/appcenp/revista/revista/leitor/apiRevistas2",

                                statusCode: {
                                    404: function () {
                                        console.log('Página fora do ar');
                                    }
                                }

                            })
                                .done(function (resultado) {
                                    $('.revistas').html(resultado);
                                    //console.log(resultado);
                                    //$(".download").hide();
                                    window.setTimeout(function () {
                                        $.each($('.btnViewRevista'), function (key, value) {
                                            //console.log($('.download:eq(' + key + ')').attr('id'));
                                            //window.resolveLocalFileSystemURL(cordova.file.dataDirectory, function (dir) { dir.getDirectory($('.download:eq(' + key + ')').attr('id'), { create: false }, function (e) { $('.download:eq(' + key + ')').remove(); }, function (e) { }); });
                                            //window.resolveLocalFileSystemURL(cordova.file.dataDirectory, function (dir) { dir.getDirectory($('.download:eq(' + key + ')').attr('id'), { create: false }, function (e) { $('.download:eq(' + key + ')').remove(); }, function (e) { }); });
                                            //alert($('.btnViewRevista:eq(' + key + ')').attr('id'));


                                            var idRevista_numeroRevista = $('.btnViewRevista:eq(' + key + ')').attr('id');//$(this).attr('id');
                                            var revista = idRevista_numeroRevista.split('_');
                                            var idLeitor = localStorage.getItem('id_cadastro');
                                            localStorage.setItem('revista_id', revista[0]);
                                            localStorage.setItem('revista_numero', revista[1]);

                                            return false;
                                        });

                                        location.href = 'revista.html';                                        

                                    }, 600);
                                })
                                .fail(function () {
                                                                                                                 
                                    //location.href = "login.html";
                                })
                                .always(function () {
                                    //alert( "complete" );
                                });
                        } else {
                            var resultado;
                            resultado = localStorage.getItem('CAPA');
                            $('.revistas').html('<div>MODO OFFLINE<br></div>' + resultado);
                            //console.log(resultado);
                            //$(".download").hide();
                            window.setTimeout(function () {
                                $.each($('.btnViewRevista'), function (key, value) {
                                    //console.log($('.download:eq(' + key + ')').attr('id'));
                                    //window.resolveLocalFileSystemURL(cordova.file.dataDirectory, function (dir) { dir.getDirectory($('.download:eq(' + key + ')').attr('id'), { create: false }, function (e) { $('.download:eq(' + key + ')').remove(); }, function (e) { }); });
                                    //window.resolveLocalFileSystemURL(cordova.file.dataDirectory, function (dir) { dir.getDirectory($('.download:eq(' + key + ')').attr('id'), { create: false }, function (e) { $('.download:eq(' + key + ')').remove(); }, function (e) { }); });
                                    console.log($('.btnViewRevista:eq(' + key + ')').attr('id'));
                                });
                                
                            }, 600);

                        }

                    //}, 1000);




                } else {
                    location.href = "login.html";
                }

            //}, 3000);

        }
    </script>
</body>
</html>